# ASP.NET
# Build and test ASP.NET projects.
# Add steps that publish symbols, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/apps/aspnet/build-aspnet-4

name: 'Socially api CI'

trigger:
  branches:
    include:
      - master
  paths:
    include:
      - src/Socially.Core
      - src/Socially.Server.DataAccess
      - src/Socially.Server.Services
      - src/Socially.WebAPI

pool:
  vmImage: 'ubuntu-18.04'

steps:

- task: UseDotNet@2
  name: 'dotnet'
  displayName: 'Use .NET Core sdk'
  inputs:
    packageType: sdk
    version: 5.0.100-preview.2.20176.6
    installationPath: $(Agent.ToolsDirectory)/dotnet

- task: DotNetCoreCLI@1
  name: 'test'
  displayName: 'Tests for API'
  inputs:
    command: 'test'
    projects: |
      src/Socially.Server.Managers.Tests
      src/Socially.WebAPI.IntegrationTests
    arguments: '-c Release'

- task: DotNetCoreCLI@2
  name: 'build'
  displayName: 'Build API'
  inputs:
    command: 'build'
    projects: 'src/Socially.WebAPI/*.csproj'
    arguments: '-c Release -o $(Build.ArtifactStagingDirectory)'

- task: PublishBuildArtifacts@1
  name: 'drop'
  displayName: 'Publish for release'
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'drop'
    publishLocation: 'Container'